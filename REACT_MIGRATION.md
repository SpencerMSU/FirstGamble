# План миграции проекта на React

Этот документ описывает поэтапный план перехода текущего проекта (HTML/JS + FastAPI) на Single Page Application (SPA) с использованием React.

## Этап 1: Подготовка и Инициализация

1.  **Создание React-приложения**
    *   Инициализировать новый проект (например, с помощью Vite для скорости и легковесности).
    *   `npm create vite@latest frontend -- --template react-ts` (рекомендуется TypeScript для типизации).
    *   Настроить структуру папок (`src/components`, `src/pages`, `src/hooks`, `src/api`, `src/assets`).

2.  **Настройка окружения**
    *   Установить необходимые зависимости: `react-router-dom` (маршрутизация), `axios` (API запросы), `framer-motion` (анимации, опционально), `@twa-dev/sdk` (SDK для Telegram Web App).
    *   Настроить проксирование запросов к API (FastAPI) в `vite.config.ts` для разработки.

## Этап 2: Базовые компоненты и Стилизация

1.  **Портирование стилей**
    *   Перенести глобальные переменные CSS (темы, цвета) в `index.css` или использовать CSS-in-JS / Tailwind CSS.
    *   Рекомендуется использовать Tailwind CSS для быстрого переноса utility-классов.

2.  **Создание UI Kit**
    *   Создать переиспользуемые компоненты: `Button`, `Card`, `Modal`, `Loader`.
    *   Реализовать компонент `Layout` (обертка для страниц с навигацией).

## Этап 3: Интеграция с Telegram и Аутентификация

1.  **Telegram WebApp Context**
    *   Создать React Context или Hook (`useTelegram`) для доступа к `window.Telegram.WebApp`.
    *   Реализовать логику получения `initData` и передачи её в заголовках API запросов (`X-Telegram-InitData`).

2.  **Глобальное состояние (State Management)**
    *   Выбрать стейт-менеджер (Zustand, Redux Toolkit или React Context).
    *   Создать стор для данных пользователя: `user`, `balance`, `tickets` и т.д.
    *   Реализовать механизм инициализации приложения (запрос профиля при старте).

## Этап 4: Миграция Страниц (Маршрутизация)

1.  **Настройка Роутинга**
    *   Определить маршруты в `react-router-dom`:
        *   `/` -> Главная (Menu)
        *   `/profile` -> Кабинет (`cabinet/cabinet.html`)
        *   `/minigames` -> Список игр (`ludka/ludka.html`)
        *   `/community` -> Чат (`community/chat.html`)
        *   `/admin` -> Админка

2.  **Перенос логики страниц**
    *   **Главная / Меню:** Перенести сетку карточек.
    *   **Профиль:** Перенести отображение статистики, достижений (Achievements Tab) и инвентаря.
    *   **Чат:** Реализовать поллинг сообщений (или WebSocket, если планируется возвращение) с использованием React Hooks (`useEffect`).

## Этап 5: Миграция Мини-игр

Это самый сложный этап, так как игры написаны на чистом JS + Canvas.

1.  **Стратегия "Iframe" (Временное решение)**
    *   Можно оставить игры как есть (отдельные HTML файлы) и открывать их через `iframe` внутри React-страницы или перенаправлять на статические HTML.
    *   *Плюсы:* Быстро.
    *   *Минусы:* Проблемы с передачей состояния (обновление баланса после игры).

2.  **Стратегия "Canvas Component" (Полная миграция)**
    *   Обернуть код каждой игры (например, `City Bloxx`, `Doodle Jump`) в React-компонент.
    *   Логику игры (Game Loop, `requestAnimationFrame`) вынести в `useEffect`.
    *   `canvas` элемент создавать через `useRef`.
    *   Вместо прямых `fetch` вызовов использовать функции из API слоя React-приложения для отправки результатов.
    *   Пример: компонент `GameStack` рендерит `<canvas ref={canvasRef} />` и запускает игру при маунте.

## Этап 6: API и Взаимодействие с Бэкендом

1.  **API Client**
    *   Настроить экземпляр Axios с интерцепторами для автоматического добавления токенов/initData.
    *   Обработка ошибок (например, 401/403 -> редирект или показ ошибки).

## Этап 7: Сборка и Деплой

1.  **Build**
    *   Настроить сборку проекта (`npm run build`), которая генерирует статические файлы в папку `dist`.
2.  **Integration with Backend**
    *   Настроить FastAPI на раздачу статики из папки `dist` (для Production).
    *   Либо настроить Nginx для раздачи статики и проксирования `/api` запросов на FastAPI.

## Примерная структура проекта (React)

```
src/
  ├── api/              # API методы (endpoints)
  ├── components/       # UI компоненты (Button, Modal...)
  ├── context/          # Глобальные контексты
  ├── hooks/            # Кастомные хуки (useTelegram, useGameLoop)
  ├── pages/            # Компоненты страниц (Home, Profile, Games...)
  ├── games/            # Логика игр (портированная)
  │     ├── stack/
  │     └── doodle/
  ├── utils/            # Утилиты
  ├── App.tsx           # Корневой компонент + Роутинг
  └── main.tsx          # Точка входа
```
