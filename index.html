<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FirstClub ‚Äî FirstClub</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<script src="/webapp_guard.js"></script>
<style>
:root{--bg:#0a0d12;--bg2:#0e1117;--panel:#0d1117;--card:#111722;--card2:#0f1520;--stroke:rgba(255,255,255,.06);--stroke2:rgba(100,160,255,.25);--blue:#3b82f6;--blue2:#1d4ed8;--text:#e6edf3;--muted:#98a2b3;--shadow:0 0 0 1px var(--stroke),0 8px 30px rgba(0,0,0,.6);}
html[data-theme="light"]{--bg:#f4f7fb;--bg2:#eef2f7;--panel:#fff;--card:#fff;--card2:#f6f8fb;--stroke:rgba(10,20,40,.08);--stroke2:rgba(59,130,246,.35);--blue:#2563eb;--blue2:#1d4ed8;--text:#0b1220;--muted:#52607a;--shadow:0 0 0 1px var(--stroke),0 10px 26px rgba(10,20,40,.08);}
html,body{height:100%;overflow:hidden;overscroll-behavior:none;-webkit-overflow-scrolling:auto;touch-action:manipulation;}
*{box-sizing:border-box}
body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;color:var(--text);
background:radial-gradient(1000px 600px at 10% -10%,rgba(59,130,246,.28),transparent 60%),
radial-gradient(800px 500px at 110% 0%,rgba(29,78,216,.22),transparent 55%),
linear-gradient(180deg,var(--bg2) 0%,var(--bg) 100%);min-height:100vh;display:flex;justify-content:center;padding:16px;}
.app{width:min(1000px,100%);border:1px solid var(--stroke);border-radius:20px;box-shadow:var(--shadow);padding:14px;
background:linear-gradient(180deg,rgba(255,255,255,.03),rgba(255,255,255,0));height:100%;overflow-y:auto;overscroll-behavior:none;}
.container,.content{height:100%;overflow-y:auto;overscroll-behavior:none;}
header{display:flex;align-items:center;justify-content:space-between;padding:10px 12px 14px;gap:10px;}
.title{display:flex;flex-direction:column;gap:2px;align-items:center;flex:1;}
.title h1{margin:0;font-size:20px;font-weight:800;} .title span{font-size:12px;color:var(--muted);}
.back{display:inline-flex;align-items:center;gap:8px;padding:8px 12px;border-radius:10px;background:linear-gradient(180deg,var(--card) 0%,var(--card2) 100%);
border:1px solid var(--stroke);color:var(--text);text-decoration:none;font-weight:700;font-size:14px;cursor:pointer;transition:.15s ease;}
.back:hover{border-color:var(--stroke2);transform:translateY(-1px);}
.balance-pill{display:flex;align-items:center;gap:8px;padding:7px 10px;border-radius:999px;font-weight:800;font-size:14px;
background:linear-gradient(180deg,var(--card) 0%,var(--card2) 100%);border:1px solid var(--stroke);box-shadow:var(--shadow);min-width:64px;justify-content:center;}
.section{background:linear-gradient(180deg,var(--panel) 0%,color-mix(in oklab,var(--panel) 92%,transparent) 100%);border:1px solid var(--stroke);
border-radius:16px;padding:14px;box-shadow:var(--shadow);margin-bottom:12px;}
.grid{display:grid;grid-template-columns:1.2fr 1fr;gap:12px;}
.cardbtn{display:flex;justify-content:space-between;align-items:center;padding:14px;border-radius:14px;border:1px solid var(--stroke);
background:linear-gradient(180deg,var(--card) 0%,var(--card2) 100%);cursor:pointer;transition:.15s ease;text-decoration:none;color:var(--text);}
.cardbtn:hover{border-color:var(--stroke2);transform:translateY(-1px);} .cardbtn h3{margin:0;font-size:16px;font-weight:900;}
.cardbtn p{margin:4px 0 0;font-size:12px;color:var(--muted);}
@media (max-width:720px){.grid{grid-template-columns:1fr;}}
.menu-btn{margin-top:12px;width:100%;padding:12px;border-radius:12px;border:1px dashed var(--stroke2);background:linear-gradient(180deg,var(--card) 0%,var(--card2) 100%);color:var(--text);font-weight:800;cursor:pointer;display:none;}
.menu-btn:hover{border-style:solid;}
.muted{color:var(--muted);font-size:13px;}
.admin-fab{position:fixed;top:12px;left:12px;width:46px;height:46px;border-radius:50%;border:1px solid var(--stroke);background:linear-gradient(180deg,var(--card) 0%,var(--card2) 100%);box-shadow:var(--shadow);color:var(--text);display:flex;align-items:center;justify-content:center;font-weight:900;cursor:pointer;z-index:9999;transition:.15s ease;}
.admin-fab:hover{border-color:var(--stroke2);transform:translateY(-1px);} .admin-fab:active{transform:scale(.98);}
.modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,.65);display:none;align-items:center;justify-content:center;padding:16px;z-index:9998;}
.modal-backdrop.active{display:flex;}
.modal-window{width:min(380px,100%);background:linear-gradient(180deg,var(--panel) 0%,var(--card) 100%);border:1px solid var(--stroke2);border-radius:16px;box-shadow:var(--shadow);padding:18px;}
.modal-window h3{margin:0 0 4px;font-size:18px;}
.modal-window label{display:block;font-size:13px;color:var(--muted);margin-top:10px;margin-bottom:6px;}
.modal-window input{width:100%;padding:10px;border-radius:10px;border:1px solid var(--stroke);background:var(--card2);color:var(--text);font-weight:700;}
.modal-actions{display:flex;gap:10px;margin-top:14px;}
.modal-actions button{flex:1;padding:11px;border-radius:12px;border:1px solid var(--stroke2);cursor:pointer;font-weight:800;}
.modal-actions button.primary{background:linear-gradient(180deg,var(--blue) 0%,var(--blue2) 100%);color:var(--text);}
.modal-actions button.secondary{background:linear-gradient(180deg,var(--card) 0%,var(--card2) 100%);color:var(--text);border-style:dashed;}
</style>
</head>
<body>
<button id="admin-login-fab" class="admin-fab" type="button" title="–ê–¥–º–∏–Ω–∫–∞">‚öôÔ∏è</button>
<div id="admin-login-modal" class="modal-backdrop" role="dialog" aria-modal="true" aria-labelledby="admin-login-title">
  <div class="modal-window">
    <h3 id="admin-login-title">–í—Ö–æ–¥ –≤ –∞–¥–º–∏–Ω–∫—É</h3>
    <div class="muted">–î–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ –ø–æ –ª–æ–≥–∏–Ω—É –∏ –ø–∞—Ä–æ–ª—é.</div>
    <form id="admin-login-form">
      <label for="admin-login">–õ–æ–≥–∏–Ω</label>
      <input id="admin-login" name="login" type="text" autocomplete="username" required>
      <label for="admin-password">–ü–∞—Ä–æ–ª—å</label>
      <input id="admin-password" name="password" type="password" autocomplete="current-password" required>
      <div class="modal-actions">
        <button type="submit" class="primary">–í–æ–π—Ç–∏</button>
        <button type="button" id="admin-login-cancel" class="secondary">–û—Ç–º–µ–Ω–∞</button>
      </div>
    </form>
  </div>
</div>
<div class="app">
<header>
<div style="width:64px"></div>
<div class="title">
<h1>FirstClub</h1>
<span>–í—ã–±–µ—Ä–∏ —Ä–∞–∑–¥–µ–ª</span>
</div>
<div class="balance-pill"><span>ü™ô</span><span id="balanceValue">0</span></div>
</header>

<section class="section grid">
  <a class="cardbtn" href="/ludka">
    <div>
      <h3>üé∞ –õ—É–¥–∫–∞</h3>
      <p>–ú–∏–Ω–∏‚Äë–∏–≥—Ä—ã</p>
    </div>
    <div>‚Üí</div>
  </a>

  <a class="cardbtn" href="/prices">
    <div>
      <h3>üí∞ –¶–µ–Ω—ã</h3>
      <p>–ü—Ä–∞–π—Å‚Äë–ª–∏—Å—Ç—ã, —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫, –ø–æ–∏—Å–∫</p>
    </div>
    <div>‚Üí</div>
  </a>

  <a class="cardbtn" href="/rpg">
    <div>
      <h3>üó∫Ô∏è RPG</h3>
      <p>–ü—Ä–æ–∫–∞—á–∫–∞, –∫–≤–µ—Å—Ç—ã, —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</p>
    </div>
    <div>‚Üí</div>
  </a>

  <a class="cardbtn" href="/shop">
    <div>
      <h3>üõí –ú–∞–≥–∞–∑–∏–Ω</h3>
      <p>–¢–æ–≤–∞—Ä—ã, –ø–æ–∫—É–ø–∫–∏, –±–æ–Ω—É—Å—ã</p>
    </div>
    <div>‚Üí</div>
  </a>

  <a class="cardbtn" href="/raffles">
    <div>
      <h3>üéÅ –†–æ–∑—ã–≥—Ä—ã—à–∏</h3>
      <p>–ê–Ω–∏–º–∞—Ü–∏–∏ –∏ —Ç–∏–∑–µ—Ä ¬´–°–∫–æ—Ä–æ¬ª</p>
    </div>
    <div>‚Üí</div>
  </a>
    <a class="cardbtn" href="/cabinet">
  <div>
    <h3>üë§ –õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</h3>
    <p>–¢–≤–æ–π TG ID –∏ –±–∏–ª–µ—Ç—ã —Ä–æ–∑—ã–≥—Ä—ã—à–∞</p>
  </div>
  <div class="badge">‚Üí</div>
    </a>

  <button id="admin-panel-btn" class="menu-btn">–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</button>

</section>

</div>

<script>
const tgInstance = initTelegramGuard();
const searchUid = new URLSearchParams(window.location.search).get("uid");
const ADMIN_FLAG_KEY = "fg_is_admin";

function getTgUserId(){
  try{ return tg?.initDataUnsafe?.user?.id || null; }catch(e){ return null; }
}

const uid = getTgUserId() || searchUid;

async function loadBalance(){
  const currentUid=getTgUserId() || searchUid;
  const el=document.getElementById("balanceValue");
  if(!el) return;
  try{
    let url = "/api/balance";
    if(currentUid) url += "?user_id="+currentUid;
    const d = await apiGet(url);
    el.textContent=d.balance??0;
    localStorage.setItem("balance_local", el.textContent);
  }catch(e){
    el.textContent=localStorage.getItem("balance_local")||"0";
  }
}

function isAdmin(){
  return localStorage.getItem(ADMIN_FLAG_KEY) === "1";
}

function openAdminPanel(){
  window.location.href = "/admin";
}

function closeAdminModal(){
  const modal = document.getElementById("admin-login-modal");
  modal.classList.remove("active");
  const form = document.getElementById("admin-login-form");
  if(form){
    form.reset();
  }
}

function openAdminModal(){
  const modal = document.getElementById("admin-login-modal");
  modal.classList.add("active");
  const loginInput = document.getElementById("admin-login");
  setTimeout(() => loginInput?.focus(), 50);
}

function updateAdminButtons(){
  const hasAccess = isAdmin();
  const btn = document.getElementById("admin-panel-btn");
  if(btn){
    btn.style.display = hasAccess ? "block" : "none";
    btn.onclick = openAdminPanel;
  }
  const fab = document.getElementById("admin-login-fab");
  if(fab){
    fab.title = hasAccess ? "–û—Ç–∫—Ä—ã—Ç—å –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å" : "–í—Ö–æ–¥ –≤ –∞–¥–º–∏–Ω–∫—É";
  }
}

document.getElementById("admin-login-fab")?.addEventListener("click", () => {
  if(isAdmin()){
    openAdminPanel();
  }else{
    openAdminModal();
  }
});

document.getElementById("admin-login-cancel")?.addEventListener("click", closeAdminModal);

document.getElementById("admin-login-modal")?.addEventListener("click", (e) => {
  if(e.target === e.currentTarget){
    closeAdminModal();
  }
});

document.getElementById("admin-login-form")?.addEventListener("submit", (e) => {
  e.preventDefault();
  const login = document.getElementById("admin-login")?.value.trim();
  const pass = document.getElementById("admin-password")?.value.trim();
  if(login === "admin" && pass === "admin"){
    localStorage.setItem(ADMIN_FLAG_KEY, "1");
    closeAdminModal();
    updateAdminButtons();
    openAdminPanel();
  }else{
    alert("–ù–µ–≤–µ—Ä–Ω—ã–π –ª–æ–≥–∏–Ω –∏–ª–∏ –ø–∞—Ä–æ–ª—å");
  }
});

updateAdminButtons();

(async () => {
  if(!tgInstance) return;
  const prof = await fetchProfile();
  if(prof && prof.ok){
    const name = (prof.name || "").trim();
    if(!name){
      const query = uid ? `?uid=${uid}` : "";
      window.location.href = `/nickname${query}`;
      return;
    }
  }
  loadBalance();
})();
</script>
</body>
</html>
