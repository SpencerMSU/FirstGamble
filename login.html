<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Вход в админку — FirstClub</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script src="/webapp_guard.js"></script>
  <style>
    :root{--bg:#0a0d12;--bg2:#0e1117;--panel:#0d1117;--card:#111722;--card2:#0f1520;--stroke:rgba(255,255,255,.06);--stroke2:rgba(100,160,255,.25);--blue:#3b82f6;--blue2:#1d4ed8;--text:#e6edf3;--muted:#98a2b3;--shadow:0 0 0 1px var(--stroke),0 8px 30px rgba(0,0,0,.6);--red:#ef4444;}
    html[data-theme="light"]{--bg:#f4f7fb;--bg2:#eef2f7;--panel:#fff;--card:#fff;--card2:#f6f8fb;--stroke:rgba(10,20,40,.08);--stroke2:rgba(59,130,246,.35);--blue:#2563eb;--blue2:#1d4ed8;--text:#0b1220;--muted:#52607a;--shadow:0 0 0 1px var(--stroke),0 10px 26px rgba(10,20,40,.08);}
    html,body{height:100%;overflow:hidden;overscroll-behavior:none;-webkit-overflow-scrolling:auto;touch-action:manipulation;}
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;color:var(--text);
    background:radial-gradient(1000px 600px at 10% -10%,rgba(59,130,246,.28),transparent 60%),
    radial-gradient(800px 500px at 110% 0%,rgba(29,78,216,.22),transparent 55%),
    linear-gradient(180deg,var(--bg2) 0%,var(--bg) 100%);min-height:100vh;display:flex;justify-content:center;padding:16px;align-items:center;}

    .login-card{
      width:min(400px, 100%);
      background:linear-gradient(180deg,var(--panel) 0%,color-mix(in oklab,var(--panel) 92%,transparent) 100%);
      border:1px solid var(--stroke);
      border-radius:20px;
      padding:24px;
      box-shadow:var(--shadow);
      display:flex;
      flex-direction:column;
      gap:16px;
    }

    h2{margin:0;font-size:22px;text-align:center;font-weight:800;}

    .input-group{display:flex;flex-direction:column;gap:6px;}
    label{font-size:13px;color:var(--muted);font-weight:700;}
    input{
      padding:12px; border-radius:12px; border:1px solid var(--stroke);
      background:var(--card); color:var(--text); font-size:16px; outline:none;
      transition:.15s;
    }
    input:focus{border-color:var(--blue);box-shadow:0 0 0 2px var(--stroke2);}

    .btn{
      padding:12px; border-radius:12px; border:none;
      background:var(--blue); color:white; font-weight:800; font-size:16px;
      cursor:pointer; transition:.15s; margin-top:8px;
    }
    .btn:hover{background:var(--blue2);transform:translateY(-1px);}
    .btn:active{transform:scale(.98);}

    .back-btn{
      text-align:center; margin-top:12px;
      color:var(--muted); text-decoration:none; font-size:14px; font-weight:700;
      cursor:pointer;
    }
    .back-btn:hover{color:var(--text);}

    .error-msg{
      color:var(--red); font-size:14px; font-weight:700; text-align:center;
      min-height:20px;
    }
  </style>
</head>
<body>

<div class="login-card">
  <h2>Вход в админку</h2>

  <div class="input-group">
    <label>Логин</label>
    <input type="text" id="username" placeholder="Введите логин" autocomplete="username">
  </div>

  <div class="input-group">
    <label>Пароль</label>
    <input type="password" id="password" placeholder="Введите пароль" autocomplete="current-password">
  </div>

  <div id="errorBox" class="error-msg"></div>

  <button class="btn" id="loginBtn">Войти</button>

  <a class="back-btn" href="/">← Вернуться назад</a>
</div>

<script>
  const tgInstance = initTelegramGuard();
  const loginBtn = document.getElementById("loginBtn");
  const errorBox = document.getElementById("errorBox");
  const usernameInput = document.getElementById("username");
  const passwordInput = document.getElementById("password");

  async function doLogin(){
    errorBox.textContent = "";
    const username = usernameInput.value.trim();
    const password = passwordInput.value;

    if(!username || !password){
      errorBox.textContent = "Заполните все поля";
      return;
    }

    loginBtn.disabled = true;
    loginBtn.textContent = "Вход...";

    try{
      const res = await fetch(API_BASE + "/api/admin/login", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        credentials: "include",
        body: JSON.stringify({username, password}),
      });

      const data = await res.json().catch(()=>({}));

      if(!res.ok || !data.ok){
        throw new Error(data.detail || data.error || "Ошибка авторизации");
      }

      // Success
      window.location.href = "/admin";
    }catch(e){
      errorBox.textContent = e.message;
    }finally{
      loginBtn.disabled = false;
      loginBtn.textContent = "Войти";
    }
  }

  loginBtn.addEventListener("click", doLogin);

  // Enter key support
  passwordInput.addEventListener("keypress", (e)=>{
    if(e.key==="Enter") doLogin();
  });
</script>

</body>
</html>
