<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>RPG ‚Äî FirstClub</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
:root{
  --bg:#0a0d12;--bg2:#0e1117;--panel:#0d1117;
  --card:#111722;--card2:#0f1520;
  --stroke:rgba(255,255,255,06);--stroke2:rgba(100,160,255,25);
  --blue:#3b82f6;--blue2:#1d4ed8;
  --text:#e6edf3;--muted:#98a2b3;
  --green:#22c55e; --red:#ef4444; --amber:#f59e0b;
  --shadow:0 0 0 1px var(--stroke),0 8px 30px rgba(0,0,0,6);
  --radius:18px;
}
html[data-theme="light"]{
  --bg:#f4f7fb;--bg2:#eef2f7;--panel:#fff;
  --card:#fff;--card2:#f6f8fb;
  --stroke:rgba(10,20,40,08);--stroke2:rgba(59,130,246,35);
  --blue:#2563eb;--blue2:#1d4ed8;
  --text:#0b1220;--muted:#52607a;
  --shadow:0 0 0 1px var(--stroke),0 10px 26px rgba(10,20,40,08);
}
*{box-sizing:border-box}
body{
  margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;color:var(--text);
  background:
    radial-gradient(1000px 600px at 10% -10%,rgba(59,130,246,28),transparent 60%),
    radial-gradient(800px 500px at 110% 0%,rgba(29,78,216,22),transparent 55%),
    linear-gradient(180deg,var(--bg2) 0%,var(--bg) 100%);
  min-height:100vh;display:flex;justify-content:center;padding:16px;
}
.app{
  width:min(1100px,100%);
  border:1px solid var(--stroke);border-radius:20px;box-shadow:var(--shadow);
  padding:14px;background:linear-gradient(180deg,rgba(255,255,255,03),rgba(255,255,255,0));
}
header{display:flex;align-items:center;justify-content:space-between;padding:10px 12px 14px;gap:10px;}
.title{display:flex;flex-direction:column;gap:2px;align-items:center;flex:1;}
.title h1{margin:0;font-size:20px;font-weight:800;}
.title span{font-size:12px;color:var(--muted);}
.back{
  display:inline-flex;align-items:center;gap:8px;padding:8px 12px;border-radius:10px;
  background:linear-gradient(180deg,var(--card) 0%,var(--card2) 100%);
  border:1px solid var(--stroke);color:var(--text);text-decoration:none;font-weight:700;font-size:14px;
  cursor:pointer;transition:.15s ease;
}
.back:hover{border-color:var(--stroke2);transform:translateY(-1px);}
.balance-pill{
  display:flex;align-items:center;gap:8px;padding:7px 10px;border-radius:999px;font-weight:800;font-size:14px;
  background:linear-gradient(180deg,var(--card) 0%,var(--card2) 100%);
  border:1px solid var(--stroke);box-shadow:var(--shadow);min-width:64px;justify-content:center;
}

.section{
  background:linear-gradient(180deg,var(--panel) 0%,color-mix(in oklab,var(--panel) 92%,transparent) 100%);
  border:1px solid var(--stroke);border-radius:16px;padding:14px;box-shadow:var(--shadow);margin-bottom:12px;
}

/* —Ç–æ–ø-–∫–Ω–æ–ø–∫–∏ */
.top-actions{
  display:flex;gap:8px;flex-wrap:wrap;
}
.small-btn{
  flex:1 1 120px;
  display:flex;align-items:center;justify-content:center;gap:8px;
  padding:10px 12px;border-radius:12px;border:1px solid var(--stroke);
  background:linear-gradient(180deg,var(--card) 0%,var(--card2) 100%);
  font-weight:800;font-size:14px;cursor:pointer;transition:.15s ease;
}
.small-btn.active{border-color:var(--stroke2);box-shadow:0 0 0 2px color-mix(in oklab,var(--blue) 35%,transparent);}
.small-btn:hover{transform:translateY(-1px);}

/* –±–æ–ª—å—à–∞—è –∫–Ω–æ–ø–∫–∞ –¥–æ–±—ã—á–∏ */
.gather-btn{
  width:100%;margin-top:10px;
  display:flex;align-items:center;justify-content:center;gap:10px;
  padding:14px;border-radius:14px;border:1px solid var(--stroke);
  background:linear-gradient(135deg,var(--blue2),var(--blue));
  color:#fff;font-weight:900;font-size:16px;cursor:pointer;transition:.15s ease;
  box-shadow:0 10px 20px rgba(59,130,246,.35);
}
.gather-btn:disabled{opacity:.6;cursor:not-allowed;}

/* –≤–∫–ª–∞–¥–∫–∏ –≤–µ—Ä—Å—Ç–∞–∫–∞ */
.subtabs{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:10px;}
.subtab{
  padding:8px 10px;border-radius:10px;border:1px solid var(--stroke);
  background:linear-gradient(180deg,var(--card) 0%,var(--card2) 100%);
  font-weight:800;font-size:13px;cursor:pointer;transition:.15s ease;
}
.subtab.active{border-color:var(--stroke2);}
.subtab:hover{transform:translateY(-1px);}

.list{
  display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:10px;
}
@media (max-width:720px){ .list{grid-template-columns:1fr;} }

.item{
  border:1px solid var(--stroke);border-radius:12px;padding:12px;
  background:linear-gradient(180deg,var(--card) 0%,var(--card2) 100%);
  display:flex;flex-direction:column;gap:6px;
}
.item h3{margin:0;font-size:15px;font-weight:900;}
.req{font-size:12px;color:var(--muted);}
.item .row{display:flex;gap:6px;flex-wrap:wrap;font-size:12px;}
.pill{
  padding:4px 6px;border-radius:999px;border:1px solid var(--stroke);
  background:var(--panel);font-weight:800;
}
.item button{
  margin-top:6px;padding:8px;border:none;border-radius:10px;
  background:linear-gradient(135deg,var(--blue2),var(--blue));color:#fff;
  font-weight:900;cursor:pointer;
}
.item button:disabled{opacity:.5;cursor:not-allowed;}

.inv-grid{
  display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:10px;
}
@media (max-width:720px){ .inv-grid{grid-template-columns:repeat(2,minmax(0,1fr));} }

.inv-card{
  border:1px solid var(--stroke);border-radius:12px;padding:10px;
  background:linear-gradient(180deg,var(--card) 0%,var(--card2) 100%);
  display:flex;flex-direction:column;gap:4px;
}
.inv-card .name{font-weight:900;}
.inv-card .cnt{font-size:13px;color:var(--muted);}
.inv-card .bar{
  height:8px;border-radius:999px;background:var(--panel);overflow:hidden;border:1px solid var(--stroke);
}
.inv-card .bar > div{
  height:100%;background:linear-gradient(90deg,var(--blue2),var(--blue));
  width:0%;
}

.hidden{display:none;}
.note{font-size:12px;color:var(--muted);}
</style>
</head>

<body>
<div class="app">
  <header>
    <a class="back" href="/">‚Üê –ù–∞–∑–∞–¥</a>
    <div class="title">
      <h1>RPG</h1>
      <span>–î–æ–±—ã—á–∞ ‚Ä¢ –ö—Ä–∞—Ñ—Ç ‚Ä¢ –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</span>
    </div>
    <div class="balance-pill"><span>ü™ô</span><span id="balanceValue">0</span></div>
  </header>

  <!-- –≤–µ—Ä—Ö–Ω–µ–µ –º–µ–Ω—é -->
  <section class="section">
    <div class="top-actions">
      <button class="small-btn active" data-tab="inventory">üéí –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</button>
      <button class="small-btn" data-tab="shop">üõí –ú–∞–≥–∞–∑–∏–Ω</button>
      <button class="small-btn" data-tab="workbench">üõ† –í–µ—Ä—Å—Ç–∞–∫</button>
    </div>

    <button id="gatherBtn" class="gather-btn">‚õè –î–æ–±—ã—Ç—å —Ä–µ—Å—É—Ä—Å—ã</button>
    <div class="note" style="margin-top:8px;">
      –î–æ–±—ã—á–∞ –¥–∞—ë—Ç –±–∞–∑–æ–≤—ã–µ —Ä–µ—Å—É—Ä—Å—ã. –ò—Ö –º–æ–∂–Ω–æ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤—ã–≤–∞—Ç—å –≤ —Ä–µ–¥–∫–∏–µ –∏ –∫—Ä–∞—Ñ—Ç–∏—Ç—å –ø—Ä–µ–¥–º–µ—Ç—ã.
    </div>
  </section>

  <!-- –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å -->
  <section class="section" id="tab-inventory">
    <h3 style="margin-top:0;">–†–µ—Å—É—Ä—Å—ã</h3>
    <div id="invGrid" class="inv-grid"></div>
  </section>

  <!-- –º–∞–≥–∞–∑–∏–Ω-–∑–∞–≥–ª—É—à–∫–∞ -->
  <section class="section hidden" id="tab-shop">
    <p>–ú–∞–≥–∞–∑–∏–Ω RPG ‚Äî –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ. –¢—É—Ç –±—É–¥—É—Ç –±—É—Å—Ç–µ—Ä—ã, —Å–ª–æ—Ç—ã, –ø—Ä–µ–¥–º–µ—Ç—ã.</p>
  </section>

  <!-- –≤–µ—Ä—Å—Ç–∞–∫ -->
  <section class="section hidden" id="tab-workbench">
    <div class="subtabs">
      <button class="subtab active" data-sub="tools">–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã</button>
      <button class="subtab" data-sub="accessories">–ê–∫—Å–µ—Å—Å—É–∞—Ä—ã</button>
      <button class="subtab" data-sub="bags">–°—É–º–∫–∏</button>
      <button class="subtab" data-sub="transform">–ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ</button>
    </div>

    <div id="wb-tools" class="wb-list"></div>
    <div id="wb-accessories" class="wb-list hidden"></div>
    <div id="wb-bags" class="wb-list hidden"></div>
    <div id="wb-transform" class="wb-list hidden"></div>
  </section>
</div>

<script>
/* ---------- TG init (–∫–∞–∫ –≤ –æ—Å—Ç–∞–ª—å–Ω—ã—Ö —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ö) ---------- */
function isColorDark(hex){
  if(!hex||hex[0]!=="#") return false;
  const r=parseInt(hex.slice(1,3),16),g=parseInt(hex.slice(3,5),16),b=parseInt(hex.slice(5,7),16);
  return (0.299*r+0.587*g+0.114*b)/255<0.5;
}
function initTelegram(){
  const tg=window.Telegram&&window.Telegram.WebApp;
  if(!tg) return null;
  tg.ready(); tg.expand();
  const p=tg.themeParams||{};
  if(p.bg_color) document.documentElement.style.setProperty("--bg",p.bg_color);
  if(p.secondary_bg_color) document.documentElement.style.setProperty("--panel",p.secondary_bg_color);
  if(p.text_color) document.documentElement.style.setProperty("--text",p.text_color);
  if(p.hint_color) document.documentElement.style.setProperty("--muted",p.hint_color);
  if(p.text_color) document.documentElement.setAttribute("data-theme", isColorDark(p.text_color) ? "light":"dark");
  tg.setHeaderColor(p.bg_color||"#0a0d12");
  tg.setBackgroundColor(p.bg_color||"#0a0d12");
  return tg;
}
const tg=initTelegram();
if(!tg){
  const prefersLight=window.matchMedia&&window.matchMedia("(prefers-color-scheme: light)").matches;
  document.documentElement.setAttribute("data-theme", prefersLight?"light":"dark");
}
function getUidFromUrl(){ try{const u=new URL(location.href); return u.searchParams.get("uid");}catch(e){return null;} }
function getTgUserId(){ try{ return tg?.initDataUnsafe?.user?.id || getUidFromUrl(); }catch(e){ return getUidFromUrl(); } }

/* ---------- API ---------- */
const API_BASE="https://api.firstgamble.ru";
const uid = String(getTgUserId()||"");

async function loadBalance(){
  const el=document.getElementById("balanceValue");
  if(!uid){ el.textContent=localStorage.getItem("balance_local")||"0"; return; }
  try{
    const r=await fetch(API_BASE+"/api/balance?user_id="+uid);
    const d=await r.json();
    el.textContent=d.balance??0;
    localStorage.setItem("balance_local", el.textContent);
  }catch(e){
    el.textContent=localStorage.getItem("balance_local")||"0";
  }
}
loadBalance();

/* ---------- RPG –¥–∞–Ω–Ω—ã–µ (–ø–æ–∫–∞ –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ —Å—Ö–µ–º–∞, —Å –±—ç–∫–∞ –±—É–¥—É—Ç —Ä–µ–∞–ª—å–Ω—ã–µ —á–∏—Å–ª–∞) ---------- */

// –±–∞–∑–æ–≤—ã–µ —Ä–µ—Å—É—Ä—Å—ã + —Ü–µ–ø–æ—á–∫–∏ —Ä–µ–¥–∫–æ—Å—Ç–∏
const RESOURCES = [
  {id:"wood",    name:"–î–µ—Ä–µ–≤–æ",     max:999},
  {id:"stone",   name:"–ö–∞–º–µ–Ω—å",     max:999},
  {id:"iron",    name:"–ñ–µ–ª–µ–∑–æ",     max:999},
  {id:"silver",  name:"–°–µ—Ä–µ–±—Ä–æ",    max:999},
  {id:"gold",    name:"–ó–æ–ª–æ—Ç–æ",     max:999},
  {id:"crystal", name:"–ö—Ä–∏—Å—Ç–∞–ª–ª",   max:999}
];

// –ø—Ä–µ–¥–º–µ—Ç—ã –≤–µ—Ä—Å—Ç–∞–∫–∞ (–ø—Ä–∏–º–µ—Ä–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞)
const CRAFT = {
  tools: [
    {id:"axe1", name:"–¢–æ–ø–æ—Ä I", req:{ wood: 20, stone: 10 }},
    {id:"pick2", name:"–ö–∏—Ä–∫–∞ II", req:{ wood: 40, iron: 15 }},
    {id:"drill3", name:"–ë—É—Ä III", req:{ iron: 40, silver: 10, gold: 5 }}
  ],
  accessories: [
    {id:"ring1", name:"–ö–æ–ª—å—Ü–æ —É–¥–∞—á–∏", req:{ silver: 10, gold: 2 }},
    {id:"amulet2", name:"–ê–º—É–ª–µ—Ç –¥–æ–±—ã—á–∏", req:{ gold: 8, crystal: 3 }}
  ],
  bags: [
    {id:"bag1", name:"–°—É–º–∫–∞ I (+50 –ª–∏–º–∏—Ç–∞)", req:{ wood: 60, iron: 10 }},
    {id:"bag2", name:"–°—É–º–∫–∞ II (+150 –ª–∏–º–∏—Ç–∞)", req:{ iron: 30, silver: 10 }}
  ],
  transform: [
    {id:"t1", name:"–ö–∞–º–µ–Ω—å ‚Üí –ñ–µ–ª–µ–∑–æ",   from:"stone", to:"iron",  rate:10},
    {id:"t2", name:"–ñ–µ–ª–µ–∑–æ ‚Üí –°–µ—Ä–µ–±—Ä–æ",  from:"iron",  to:"silver",rate:10},
    {id:"t3", name:"–°–µ—Ä–µ–±—Ä–æ ‚Üí –ó–æ–ª–æ—Ç–æ",  from:"silver",to:"gold",  rate:10},
    {id:"t4", name:"–ó–æ–ª–æ—Ç–æ ‚Üí –ö—Ä–∏—Å—Ç–∞–ª–ª", from:"gold",  to:"crystal",rate:10}
  ]
};

// –ª–æ–∫–∞–ª—å–Ω—ã–π —Å—Ç–µ–π—Ç (–ø–æ–∫–∞ –Ω–µ—Ç —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤)
let inv = Object.fromEntries(RESOURCES.map(r=>[r.id,0]));

/* ---------- —Ä–µ–Ω–¥–µ—Ä –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è ---------- */
function renderInventory(){
  const grid=document.getElementById("invGrid");
  grid.innerHTML="";
  RESOURCES.forEach(r=>{
    const cur = inv[r.id]||0;
    const pct = Math.min(100, Math.round(cur/r.max*100));
    const card=document.createElement("div");
    card.className="inv-card";
    card.innerHTML = `
      <div class="name">üß© ${r.name}</div>
      <div class="cnt">${cur} / ${r.max}</div>
      <div class="bar"><div style="width:${pct}%"></div></div>
    `;
    grid.appendChild(card);
  });
}

/* ---------- —Ä–µ–Ω–¥–µ—Ä –≤–µ—Ä—Å—Ç–∞–∫–∞ ---------- */
function canCraft(req){
  return Object.entries(req).every(([id,need]) => (inv[id]||0) >= need);
}
function spendReq(req){
  Object.entries(req).forEach(([id,need]) => inv[id]-=need);
}

function renderCraftList(containerId, items){
  const c=document.getElementById(containerId);
  c.innerHTML = `<div class="list"></div>`;
  const list=c.querySelector(".list");

  items.forEach(it=>{
    const ok = it.req ? canCraft(it.req) : true;
    const el=document.createElement("div");
    el.className="item";
    if(it.req){
      const reqLines = Object.entries(it.req).map(([rid,need])=>{
        const have = inv[rid]||0;
        return `<span class="pill">${RESOURCES.find(x=>x.id===rid)?.name||rid}: ${have}/${need}</span>`;
      }).join("");
      el.innerHTML = `
        <h3>${it.name}</h3>
        <div class="req">–ù—É–∂–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã:</div>
        <div class="row">${reqLines}</div>
        <button ${ok?"":"disabled"} data-craft="${it.id}">–°–∫—Ä–∞—Ñ—Ç–∏—Ç—å</button>
      `;
    } else {
      // –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ
      const have = inv[it.from]||0;
      const need = it.rate;
      el.innerHTML = `
        <h3>${it.name}</h3>
        <div class="req">–ö—É—Ä—Å: ${need} ${RESOURCES.find(x=>x.id===it.from)?.name} ‚Üí 1 ${RESOURCES.find(x=>x.id===it.to)?.name}</div>
        <div class="row">
          <span class="pill">–ï—Å—Ç—å: ${have}</span>
        </div>
        <button ${have>=need?"":"disabled"} data-transform="${it.id}">
          –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å
        </button>
      `;
    }
    list.appendChild(el);
  });

  // handlers craft/transform (–ø–æ–∫–∞ –ª–æ–∫–∞–ª—å–Ω–æ)
  list.querySelectorAll("[data-craft]").forEach(btn=>{
    btn.addEventListener("click", async ()=>{
      const id=btn.dataset.craft;
      const item = Object.values(CRAFT).flat().find(x=>x.id===id);
      if(!item || !canCraft(item.req)) return;
      // TODO: —Ç—É—Ç –±—É–¥–µ—Ç POST /api/rpg/craft
      spendReq(item.req);
      renderAll();
      tg?.showPopup?.({title:"–ö—Ä–∞—Ñ—Ç", message:`${item.name} —Å–æ–∑–¥–∞–Ω(–∞)!`});
    });
  });

  list.querySelectorAll("[data-transform]").forEach(btn=>{
    btn.addEventListener("click", async ()=>{
      const id=btn.dataset.transform;
      const t = CRAFT.transform.find(x=>x.id===id);
      if(!t) return;
      // TODO: —Ç—É—Ç –±—É–¥–µ—Ç POST /api/rpg/transform
      if((inv[t.from]||0) < t.rate) return;
      inv[t.from]-=t.rate;
      inv[t.to]=(inv[t.to]||0)+1;

      // –∑–∞ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ —Ä–µ–¥–∫–∏—Ö —Ä–µ—Å—É—Ä—Å–æ–≤ –¥–æ–±–∞–≤–∏–º –º–æ–Ω–µ—Ç—ã (–ø—Ä–∏–º–µ—Ä)
      // TODO: –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ –æ—Ç–≤–µ—Ç –±—ç–∫–∞
      try{
        await fetch(API_BASE+"/api/add_point",{
          method:"POST",
          headers:{"Content-Type":"application/json"},
          body: JSON.stringify({user_id: uid, delta: 1})
        });
        loadBalance();
      }catch(e){}

      renderAll();
      tg?.showPopup?.({title:"–ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ", message:`–ü–æ–ª—É—á–µ–Ω–æ: 1 ${RESOURCES.find(x=>x.id===t.to)?.name}`});
    });
  });
}

function renderAll(){
  renderInventory();
  renderCraftList("wb-tools", CRAFT.tools);
  renderCraftList("wb-accessories", CRAFT.accessories);
  renderCraftList("wb-bags", CRAFT.bags);
  renderCraftList("wb-transform", CRAFT.transform);
}
renderAll();

/* ---------- –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –æ—Å–Ω–æ–≤–Ω—ã—Ö —Ç–∞–±–æ–≤ ---------- */
const topBtns=[...document.querySelectorAll(".small-btn")];
const tabs={
  inventory:document.getElementById("tab-inventory"),
  shop:document.getElementById("tab-shop"),
  workbench:document.getElementById("tab-workbench")
};
topBtns.forEach(b=>{
  b.addEventListener("click",()=>{
    topBtns.forEach(x=>x.classList.remove("active"));
    b.classList.add("active");
    const t=b.dataset.tab;
    Object.keys(tabs).forEach(k=>tabs[k].classList.toggle("hidden", k!==t));
  });
});

/* ---------- –ø–æ–¥—Ç–∞–± –≤–µ—Ä—Å—Ç–∞–∫–∞ ---------- */
const subBtns=[...document.querySelectorAll(".subtab")];
const subViews={
  tools:document.getElementById("wb-tools"),
  accessories:document.getElementById("wb-accessories"),
  bags:document.getElementById("wb-bags"),
  transform:document.getElementById("wb-transform")
};
subBtns.forEach(b=>{
  b.addEventListener("click",()=>{
    subBtns.forEach(x=>x.classList.remove("active"));
    b.classList.add("active");
    const s=b.dataset.sub;
    Object.keys(subViews).forEach(k=>subViews[k].classList.toggle("hidden", k!==s));
  });
});

/* ---------- –¥–æ–±—ã—á–∞ —Ä–µ—Å—É—Ä—Å–æ–≤ ---------- */
const gatherBtn=document.getElementById("gatherBtn");
gatherBtn.addEventListener("click", async ()=>{
  if(!uid){ tg?.showAlert?.("–û—Ç–∫—Ä–æ–π —á–µ—Ä–µ–∑ –±–æ—Ç–∞"); return; }
  gatherBtn.disabled=true;

  // TODO: –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ POST /api/rpg/gather
  // –ø–æ–∫–∞ –ª–æ–∫–∞–ª—å–Ω–∞—è –¥–æ–±—ã—á–∞:
  const gain = {
    wood:  5 + Math.floor(Math.random()*6),
    stone: 3 + Math.floor(Math.random()*5),
    iron:  Math.random()<0.35 ? 1 : 0
  };
  Object.entries(gain).forEach(([id,amt])=>{
    inv[id]=(inv[id]||0)+amt;
  });

  renderAll();
  tg?.showPopup?.({title:"–î–æ–±—ã—á–∞", message:`–ü–æ–ª—É—á–µ–Ω–æ: –¥–µ—Ä–µ–≤–æ ${gain.wood}, –∫–∞–º–µ–Ω—å ${gain.stone}${gain.iron?`, –∂–µ–ª–µ–∑–æ ${gain.iron}`:""}`});
  gatherBtn.disabled=false;
});
</script>
</body>
</html>
